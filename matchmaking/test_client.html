<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Matchmaking Test Client</title>
</head>
<body>
    <h1>Matchmaking Test Client</h1>

    <div>
        <label for="playerId">Player ID:</label>
        <input type="text" id="playerId" value="1">
        <br>
        <label for="playerName">Player Name:</label>
        <input type="text" id="playerName" value="Alice">
        <br>
        <label for="playerMMR">Player MMR:</label>
        <input type="number" id="playerMMR" value="1000">
        <br><br>
        <button id="connectBtn">Connect</button>
        <button id="confirmBtn" disabled>Confirm Match</button>
    </div>

    <h3>Status:</h3>
    <pre id="status"></pre>

    <script>
        let socket;

        document.getElementById('connectBtn').onclick = () => {
            const id = document.getElementById('playerId').value;
            const name = document.getElementById('playerName').value;
            const mmr = document.getElementById('playerMMR').value;

            socket = new WebSocket(`wss://localhost:3000/matchmaking?id=${id}&name=${name}&mmr=${mmr}`);

            socket.onopen = () => {
                log(`Connected as ${name}`);
            };

            socket.onmessage = (msg) => {
                console.log("Message from server:", msg.data);

                const data = JSON.parse(msg.data);
                if (data.type === 'confirm_match') {
                    document.getElementById('confirmBtn').disabled = false;
                } else if (data.type === 'match_timeout') {
                    document.getElementById('confirmBtn').disabled = true;
                    log('Match canceled. Waiting for a new opponent...');
                }
            };

            socket.onerror = (err) => {
                log(`Error: ${err.message}`);
            };

            socket.onclose = () => {
                log('Disconnected.');
                document.getElementById('confirmBtn').disabled = true;
            };
        };

        document.getElementById('confirmBtn').onclick = () => {
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify({ type: 'confirm_match' }));
                log('Sent confirm_match');
                document.getElementById('confirmBtn').disabled = true;
            }
        };

        function log(message) {
            const status = document.getElementById('status');
            status.textContent += message + "\n";
            status.scrollTop = status.scrollHeight;
        }
    </script>
</body>
</html>
